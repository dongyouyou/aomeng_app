<view class="container safe-area-bottom">
  <!-- ä¼šå‘˜é”å®šæç¤ºï¼Œå½“éœ€è¦ä¼šå‘˜ä½†ç”¨æˆ·ä¸æ˜¯ä¼šå‘˜æ—¶æ˜¾ç¤º -->
  <view class="member-lock-overlay" wx:if="{{needMembership}}">
    <view class="lock-content">
      <view class="lock-icon">ğŸ”’</view>
      <view class="lock-title">ä¼šå‘˜ä¸“äº«å†…å®¹</view>
      <view class="lock-desc">å¼€é€šä¼šå‘˜å³å¯æŸ¥çœ‹å…¨éƒ¨å¥¥ç‰¹æ›¼è‹±é›„èµ„æ–™</view>
      <button class="lock-btn" bindtap="goToMembership">ç«‹å³å¼€é€š</button>
    </view>
  </view>

  <view class="detail-content" wx:if="{{selectedHero}}">
    <!-- å†…å®¹åŒºåŸŸ - æ•´ä¸ªé¡µé¢ç»Ÿä¸€æ»šåŠ¨ -->
    <scroll-view scroll-y class="detail-body">
      <!-- é¡¶éƒ¨å›¾ç‰‡åŒº -->
      <image class="detail-image" src="{{selectedHero.image}}" mode="aspectFit"/>
      
      <!-- ä¼šå‘˜æ ‡ç­¾æç¤º -->
      <view class="member-tag" wx:if="{{needMembership}}">
        <view class="tag-icon">ğŸ‘‘</view>
        <view class="tag-text">ä¼šå‘˜ä¸“äº«</view>
      </view>
      
      <!-- ä¸»æ ‡ç­¾é¡µå¯¼èˆª - ä½äºå›¾ç‰‡ä¸‹æ–¹ -->
      <view class="tab-nav">
        <view class="tab-item {{currentTab === 'info' ? 'active' : ''}}" 
              bindtap="switchTab" 
              data-tab="info">åŸºæœ¬ä¿¡æ¯</view>
        <view class="tab-item {{currentTab === 'story' ? 'active' : ''}}" 
              bindtap="switchTab" 
              data-tab="story">è‹±é›„æ•…äº‹</view>
        <view class="tab-item {{currentTab === 'interaction' ? 'active' : ''}}" 
              bindtap="switchTab" 
              data-tab="interaction">å¨±ä¹ä¸“åŒº</view>
      </view>
      
      <!-- åŸºæœ¬ä¿¡æ¯æ ‡ç­¾é¡µ -->
      <view class="tab-content" hidden="{{currentTab !== 'info'}}">
        <text class="detail-desc">{{selectedHero.description}}</text>

        <view class="detail-section">
          <text class="section-title">èƒ½åŠ›å€¼</text>
          <view class="stats-list">
            <view class="stat-item">
              <text class="stat-label">åŠ›é‡</text>
              <view class="stat-bar" style="flex: none !important; width: 200px !important; max-width: 200px !important;">
                <view class="stat-value" style="width: 200px"></view>
              </view>
              <text class="stat-number">{{selectedHero.power || '85'}}</text>
            </view>
            <view class="stat-item">
              <text class="stat-label">é€Ÿåº¦</text>
              <view class="stat-bar" style="flex: none !important; width: 200px !important; max-width: 200px !important;">
                <view class="stat-value" style="width: 200px"></view>
              </view>
              <text class="stat-number">{{selectedHero.speed || '90'}}</text>
            </view>
            <view class="stat-item">
              <text class="stat-label">èº«é«˜</text>
              <view class="stat-bar" style="flex: none !important; width: 200px !important; max-width: 200px !important;">
                <view class="stat-value" style="width: 200px"></view>
              </view>
              <text class="stat-number">{{selectedHero.height || '50m'}}</text>
            </view>
            <view class="stat-item">
              <text class="stat-label">ä½“é‡</text>
              <view class="stat-bar" style="flex: none !important; width: 200px !important; max-width: 200px !important;">
                <view class="stat-value" style="width: 200px"></view>
              </view>
              <text class="stat-number">{{selectedHero.weight || '35000t'}}</text>
            </view>
          </view>
        </view>

        <view class="detail-section">
          <view class="feature-title-container">
            <text class="section-title character-feature-title">è§’è‰²ç‰¹ç‚¹</text>
          </view>
          <text class="hero-story">{{selectedHero.personality || 'è¿™ä½è‹±é›„å…·æœ‰å‹‡æ•¢æ— ç•çš„ç²¾ç¥ï¼Œå¯Œæœ‰æ­£ä¹‰æ„Ÿï¼Œæ€»æ˜¯æŒºèº«è€Œå‡ºä¿æŠ¤åœ°çƒå’Œäººç±»ã€‚'}}</text>
          
          <view class="hero-actions">
            <view class="action-button like-button {{isLiked ? 'active' : ''}}" bindtap="toggleLike">
              <text class="action-icon">â™¥</text>
              <text class="action-label">å–œæ¬¢</text>
            </view>
            <view class="action-button" bindtap="showComments">
              <text class="action-icon">ğŸ’¬</text>
              <text class="action-label">è¯„è®º</text>
            </view>
            <view class="action-button" bindtap="shareHero">
              <text class="action-icon">â†—</text>
              <text class="action-label">åˆ†äº«</text>
            </view>
          </view>
        </view>
      </view>
        
      <!-- è‹±é›„æ•…äº‹æ ‡ç­¾é¡µ -->
      <view class="tab-content" hidden="{{currentTab !== 'story'}}">
        <view class="story-title">{{selectedHero.name}}çš„æ•…äº‹</view>
        
        <!-- ç« èŠ‚é€‰æ‹©å™¨ - ç®€åŒ–çš„æ ·å¼ -->
        <view class="chapter-selector">
          <scroll-view scroll-x="true" class="chapter-scroll">
            <view class="chapter-tabs">
              <view 
                wx:for="{{heroStoryChapters}}" 
                wx:key="id" 
                class="chapter-tab {{currentChapter === item.id ? 'active' : ''}}"
                data-id="{{item.id}}"
                bindtap="switchChapter">
                {{item.title}}
              </view>
            </view>
          </scroll-view>
        </view>
        
        <!-- è§†é¢‘æ’­æ”¾åŒº -->
        <view class="story-video-container">
          <!-- å½“æœ‰è§†é¢‘URLæ—¶æ˜¾ç¤ºè§†é¢‘æ’­æ”¾å™¨ -->
          <block wx:if="{{currentChapterData.videoUrl && !videoLoadFailed}}">
            <video 
              id="storyVideo"
              class="story-video" 
              src="{{currentChapterData.videoUrl}}"
              controls="{{true}}"
              show-center-play-btn="{{true}}"
              bindplay="onVideoPlay"
              bindpause="onVideoPause"
              bindended="onVideoEnd"
              binderror="onVideoError"
              enable-play-gesture="{{true}}"
              enable-progress-gesture="{{true}}"
              show-fullscreen-btn="{{true}}"
              show-progress="{{true}}"
              show-mute-btn="{{true}}"
              auto-pause-if-navigate="{{false}}"
              auto-pause-if-open-native="{{false}}"
              vslide-gesture="{{true}}"
              vslide-gesture-in-fullscreen="{{true}}"
              picture-in-picture-mode="push"
              object-fit="contain"
              bindwaiting="onVideoWaiting"
              bindtimeupdate="onTimeUpdate"
              initial-time="0"
              title="{{currentChapterData.title}}">
            </video>
          </block>
          
          <!-- å½“è§†é¢‘ä¸å­˜åœ¨æˆ–åŠ è½½å¤±è´¥æ—¶æ˜¾ç¤ºæç¤º -->
          <view wx:else class="video-placeholder">
            <view class="placeholder-icon">ğŸ¥</view>
            <view class="placeholder-text">è§†é¢‘å³å°†ä¸Šçº¿ï¼Œæ•¬è¯·æœŸå¾…</view>
          </view>
        </view>
        
        <!-- æ•…äº‹å†…å®¹åŒº - ç´§å‡‘æ— ç¼è¿æ¥è®¾è®¡ -->
        <view class="story-wrapper">
          <view class="story-card no-space">
            <view class="story-header">
              <text class="story-chapter-title">{{currentChapterData.title}}</text>
              <text class="story-chapter-subtitle">{{currentChapterData.subtitle}}</text>
            </view>
            
            <view class="story-body">
              <text class="story-text">{{currentChapterData.content || selectedHero.story || selectedHero.emotionalStory || 'è¿™ä½è‹±é›„çš„æ•…äº‹æ­£åœ¨åˆ›ä½œä¸­ï¼Œæ•¬è¯·æœŸå¾…...'}}</text>
            </view>
            
            <!-- åªåœ¨æœ‰å›¾ç‰‡æ—¶æ˜¾ç¤ºå›¾ç‰‡ï¼Œä¸”ç›´æ¥ä½¿ç”¨ç¬¬ä¸€å¼ å›¾ç‰‡ -->
            <block wx:if="{{currentChapterData.images && currentChapterData.images.length > 0}}">
              <image class="direct-image" 
                     src="{{currentChapterData.images[0]}}" 
                     mode="aspectFit"
                     bindtap="previewImage" 
                     data-src="{{currentChapterData.images[0]}}" 
                     data-urls="{{currentChapterData.images}}"></image>
            </block>
          </view>
          
          <!-- æ¨èé˜…è¯»æ— ç¼è¿æ¥ -->
          <view class="detail-section recommended-section no-space-top">
            <text class="section-title">æ¨èé˜…è¯»</text>
            <scroll-view class="recommended-scroll" scroll-x>
              <view class="recommended-list">
                <view class="recommended-item" 
                  wx:for="{{recommendedStories}}" 
                  wx:key="id"
                  bindtap="goToRecommendedStory"
                  data-id="{{item.id}}"
                  data-key="{{item.key}}">
                  <image class="recommended-image" src="{{item.image}}" mode="aspectFit"></image>
                  <view class="recommended-info">
                    <text class="recommended-title">{{item.title}}</text>
                    <text class="recommended-desc">{{item.description}}</text>
                  </view>
                </view>
              </view>
            </scroll-view>
          </view>
        </view>
      </view>
        
      <!-- äº’åŠ¨ä¸“åŒºæ ‡ç­¾é¡µ -->
      <view class="tab-content" hidden="{{currentTab !== 'interaction'}}">
        <view class="interactions">
          <view class="interaction-card" bindtap="goBattlePage">
            <view class="interaction-icon">âš”ï¸</view>
            <view class="interaction-label">å¯¹æˆ˜æ¨¡å¼</view>
          </view>
          <view class="interaction-card" bindtap="startQuiz">
            <view class="interaction-icon">â“</view>
            <view class="interaction-label">çŸ¥è¯†é—®ç­”</view>
          </view>
          <view class="interaction-card" bindtap="viewGallery">
            <view class="interaction-icon">ğŸ–¼ï¸</view>
            <view class="interaction-label">å›¾ç‰‡é›†</view>
          </view>
          <view class="interaction-card" bindtap="viewVideo">
            <view class="interaction-icon">â–¶ï¸</view>
            <view class="interaction-label">è§†é¢‘é›†</view>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>
  
  <!-- è¿”å›é¡¶éƒ¨æŒ‰é’® -->
  <view class="back-to-top {{showBackToTop ? 'show' : ''}}" bindtap="scrollToTop">â†‘</view>
</view> 